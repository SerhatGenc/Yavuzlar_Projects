package wordpressversion

import (
	"strings"
	"unicode"
)

func FindWordpressVer(link string) [3][]string {

	html := HTML(link)

	regex := []string{`WordPress (\S)+?"|WordPress (\S)+?'`, `css\Sver=(\S+)"|css\Sver=(\S+)'`, `js\Sver=(\S+)"|js\Sver=(\S+)'`}

	var result [3][]string
	for j, i := range regex {

		result[j] = HtmlSearch(html, i)

	}

	for i := 0; i < 3; i++ {
		for k, l := range result[i] {
			if i == 0 {
				l = l[10:]
			} else if i == 1 {
				l = l[8:]
			} else {
				l = l[7:]
			}

			l = strings.Replace(l, ".", "", -1)

			for d, j := range l {
				if !unicode.IsDigit(j) {
					l = l[:d]
					break
				}
			}
			if len(l) < 4 {
				result[i][k] = l
			} else {
				result[i][k] = "deleted"
			}
		}
	}

	return removeDeletedElements(result)
}

func removeDeletedElements(matrix [3][]string) [3][]string {
	for i := 0; i < len(matrix); i++ {
		var newRow []string
		for j := 0; j < len(matrix[i]); j++ {
			if matrix[i][j] != "deleted" {
				newRow = append(newRow, matrix[i][j])
			}
		}
		matrix[i] = newRow
	}
	return matrix
}
