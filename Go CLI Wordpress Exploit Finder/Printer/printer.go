package printer

import (
	"os"
	"strconv"
	v "wpExploit/ApiConnect"

	"github.com/olekukonko/tablewriter"
)

func Printer(data v.Jason) {

	table := tablewriter.NewWriter(os.Stdout)
	table.SetHeader([]string{"#", "Title", "Type", "Created At", "Published Date", "Verified", "Fixed In", "CVE"})
	table.SetBorder(true)
	table.SetCenterSeparator("|")
	table.SetColumnSeparator("|")
	table.SetRowSeparator("-")
	table.SetAutoWrapText(false)

	for i, vuln := range data.Vulnerabilities {

		refs := joinStrings(vuln.References.Cve)

		verified := "No"
		if vuln.Verified {
			verified = "Yes"
		}

		vulnType := vuln.VulnType
		if vulnType == "" {
			vulnType = "N/A"
		}

		table.Append([]string{
			strconv.Itoa(i + 1),
			vuln.Title,
			vulnType,
			vuln.CreatedAt.Format("2006-01-02 15:04:05"),
			vuln.PublishedDate.Format("2006-01-02 15:04:05"),
			verified,
			vuln.FixedIn,
			refs,
		})
	}

	table.Render()
}

func joinStrings(strs []string) string {
	return join(strs, ", ")
}

func join(strs []string, separator string) string {
	if len(strs) == 0 {
		return ""
	}
	result := strs[0]
	for _, s := range strs[1:] {
		result += separator + s
	}
	return result
}
